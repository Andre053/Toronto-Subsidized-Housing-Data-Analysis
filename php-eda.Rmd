---
title: "Parkdale High-Park Subsidized Housing Analysis"
output:
  html_document: default
  pdf_document: default
date: "2025-12-11"
---

## Parkdale High-Park Subsidized Housing Analysis

This script conducts an exploratory data analysis of subsidized housing in Parkdale High-Park.

First, load the required libraries
```{r}
library(tidyverse)
library(ggplot2)
library(forcats)
library(opendatatoronto)
library(dplyr)
library(janitor)
```

Get data from API (code from Open Data Toronto)
```{r}
# get package
package <- show_package("153ea449-b7f4-4c4d-889a-ec0f89b3bbc9")
package

# get all resources for this package
resources <- list_package_resources("153ea449-b7f4-4c4d-889a-ec0f89b3bbc9")

# identify datastore resources; by default, Toronto Open Data sets datastore resource format to CSV for non-geospatial and GeoJSON for geospatial resources
datastore_resources <- filter(resources, tolower(format) %in% c('csv', 'geojson'))
```

Set and clean the dataframes before analysis.

```{r}
# create dataframes
df_building <- filter(datastore_resources, row_number()==1) %>% get_resource() |> clean_names()

df_units <- filter(datastore_resources, row_number()==2) %>% get_resource() |> clean_names()

df_units$units_available_in_the_last_12_months <- as.numeric(df_units$units_available_in_the_last_12_months)

df_units$number_of_market_rent_units <- as.numeric(df_units$number_of_market_rent_units)

df_units$number_of_subsidized_units <- as.numeric(df_units$number_of_subsidized_units)
```

In Toronto, neighbourhoods are organized by ward. The Parkdale-High Park ward is number 4.

```{r}
# types of housing available in Parkdale
df_building <- df_building |> filter(ward==4)
```

There are 26 buildings with subsidized housing are in Parkdale-High Park. 

```{r}
# exploring these buildings
df_building |> 
  ggplot(aes(x=forcats::fct_infreq(provider_type))) +
    geom_bar() +
    labs(
      title="TCHC is the most common provider in PHP",
      x="Provider type",
      y="Building count"
    )

df_building |>
  filter(provider_type=="PNP") |>
  ggplot(aes(x=forcats::fct_infreq(provider_name))) +
    geom_bar() +
    coord_flip() +
    labs(
      title="Most PNP providers run one building",
      x="Provider name",
      y="Building count"
    )

df_building |>
  filter(provider_type=="CO-OP") |>
  ggplot(aes(x=forcats::fct_infreq(provider_name))) +
    geom_bar() +
    coord_flip() +
    labs(
      title="Only two CO-OP providers are active in PHP",
      x="Provider name",
      y="Building count"
    )
```

TCHC is the largest provider with 16 buildings, followed by PNP providers running 8, and CO-OP providers running 2. Only TCHC and Villa Otthon run more than 1 building. 

```{r}
# prep units overall in PHP
php_buildings <- df_building |> select(building_complex_name) |> pull() # pull for vector
df_units <- df_units |> filter(building_complex_name %in% php_buildings)

```

There are 72 unit observations for the 26 buildings.

```{r}
# TODO: Fix scales of geom_col() and fix order
# Fix 1: Needed to convert values to numeric

# market housing compared to subsidized housing counts
# TODO: Create into a pie chart? Polar coord bar chart
df_units |> 
  select(number_of_market_rent_units, number_of_subsidized_units) |>
  summarize(
    number_of_market_rent_units = sum(number_of_market_rent_units),
    number_of_subsidized_units = sum(number_of_subsidized_units)
  )

# market units by unit size
df_units |> 
  select(unit_size, number_of_market_rent_units) |>
  group_by(unit_size) |>
  summarize(
    number_of_market_rent_units = sum(number_of_market_rent_units)
  ) |>
  ggplot(aes(x=unit_size, y=number_of_market_rent_units)) +
    geom_col(just=1) +
    coord_flip() + 
    labs(
      title="1 and 2-bedroom units provide the most market housing",
      x="Unit size",
      y="Number of subsidized rental units"
    )

# subsidized units by unit size
df_units |> 
  select(unit_size, number_of_subsidized_units) |>
  group_by(unit_size) |>
  summarize(
    number_of_subsidized_units = sum(number_of_subsidized_units)
  ) |>
  ggplot(aes(x=unit_size, y=number_of_subsidized_units)) +
    geom_col(just=1) +
    coord_flip() + 
    labs(
      title="1 bedroom units provide by far the most subsidized housing",
      x="Unit size",
      y="Number of subsidized rental units"
    )
```

There are 3938 housing units in the 26 buildings in PHP. Of these units, 17% are market housing, and the other 83% are subsidized. 

The market housing is mainly in 1 and 2-bedroom units, while the subsidized housing is overwhelmingly in 1-bedroom units. 

```{r}
# Overall stats
df_units_overall <- df_units |>
  select(number_of_market_rent_units, number_of_subsidized_units) |>
  pivot_longer(
    cols = starts_with("number_of"),
    names_to = "housing_type",
    values_to = "housing_capacity"
  )

df_units_overall |>
  group_by(housing_type) |>
  summarise(housing_capacity = sum(housing_capacity)) |>
  ggplot(aes(x="", y=housing_capacity, fill=housing_type)) +
    geom_bar(stat="identity", width=1, color="white") +
    coord_polar("y", start=0) +
    labs(
      title="Over 80% of units are subsidized",
      x = "",
      y = "Housing capacity",
      fill = "Housing type"
    ) +
    geom_text(aes(label=housing_capacity), position = position_stack(vjust = 0.5)) +
    theme_void()


```

Visualization of the previous statistics that show a large majority of units are subsidized. 

```{r}
# Housing distribution for TCHC
# prep units overall in PHP

housing_dist <- function(provider) {
  provider_buildings <- df_building |> 
    filter(provider_type==provider) |> 
    select(building_complex_name) |>  
    pull()
  
  df_prov_units <- df_units |> 
    filter(building_complex_name %in% provider_buildings) |>
    pivot_longer(
      cols = starts_with("number_of"),
      names_to = "housing_type",
      values_to = "housing_capacity"
    )
  
  df_prov_units |>
    group_by(housing_type) |>
    summarise(housing_capacity = sum(housing_capacity)) |>
    ggplot(aes(x="", y=housing_capacity, fill=housing_type)) +
      geom_bar(stat="identity", width=1, color="white") +
      coord_polar("y", start=0) +
      labs(
        title=sprintf("%s housing units", provider),
        x = "",
        y = "Housing capacity",
        fill = "Housing type"
      ) +
      geom_text(aes(label=housing_capacity), position = position_stack(vjust = 0.5)) +
      theme_void()
}

housing_dist("TCHC")
housing_dist("PNP")
housing_dist("CO-OP")
```

TCHC has the highest ratio of subsidized units to market units, followed by PNP providers, and then CO-OP providers, overall. 

## Current insights
- 26 different buildings provide subsidized housing in PHP
- Almost 4000 units in total, with over 80% of them being subsidized
- TCHC is the largest provider of housing, followed by PNP and then CO-OP providers
- Most subsidized housing is through 1-bedroom units





































